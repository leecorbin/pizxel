#!/usr/bin/env python3
"""
Generate Emoji Sprite Sheet for MatrixOS

Downloads 800 popular/useful emojis from Noto Emoji and arranges them
in a single sprite sheet PNG file for efficient offline storage.

Output:
- matrixos/emoji_spritesheet.png (single PNG with all emojis)
- matrixos/emoji_spritesheet.json (metadata mapping)
"""

import os
import urllib.request
import json
from PIL import Image
import io
import time


# 800 most popular and useful emojis for MatrixOS
# Ordered by: popularity (Unicode data) + MatrixOS relevance
EMOJI_LIST = [
    # Tier 1: Top 100 most popular (Unicode 2019 data)
    ("ğŸ˜‚", "1f602"), ("â¤ï¸", "2764"), ("ğŸ˜", "1f60d"), ("ğŸ¤£", "1f923"),
    ("ğŸ˜Š", "1f60a"), ("ğŸ™", "1f64f"), ("ğŸ’•", "1f495"), ("ğŸ˜­", "1f62d"),
    ("ğŸ˜˜", "1f618"), ("ğŸ‘", "1f44d"), ("ğŸ˜…", "1f605"), ("ğŸ‘", "1f44f"),
    ("ğŸ˜", "1f601"), ("ğŸ”¥", "1f525"), ("ğŸ’”", "1f494"), ("ğŸ’–", "1f496"),
    ("ğŸ’™", "1f499"), ("ğŸ˜¢", "1f622"), ("ğŸ¤”", "1f914"), ("ğŸ˜†", "1f606"),
    ("ğŸ™„", "1f644"), ("ğŸ’ª", "1f4aa"), ("ğŸ˜‰", "1f609"), ("â˜ºï¸", "263a"),
    ("ğŸ‘Œ", "1f44c"), ("ğŸ¤—", "1f917"), ("ğŸ’œ", "1f49c"), ("ğŸ˜”", "1f614"),
    ("ğŸ˜", "1f60e"), ("ğŸ˜‡", "1f607"), ("ğŸŒ¹", "1f339"), ("ğŸ¤¦", "1f926"),
    ("ğŸ‰", "1f389"), ("ğŸ’", "1f49e"), ("âœŒï¸", "270c"), ("âœ¨", "2728"),
    ("ğŸ¤·", "1f937"), ("ğŸ˜±", "1f631"), ("ğŸ˜Œ", "1f60c"), ("ğŸŒ¸", "1f338"),
    ("ğŸ™Œ", "1f64c"), ("ğŸ˜‹", "1f60b"), ("ğŸ’—", "1f497"), ("ğŸ’š", "1f49a"),
    ("ğŸ˜", "1f60f"), ("ğŸ’›", "1f49b"), ("ğŸ™‚", "1f642"), ("ğŸ’“", "1f493"),
    ("ğŸ¤©", "1f929"), ("ğŸ˜„", "1f604"), ("ğŸ˜€", "1f600"), ("ğŸ–¤", "1f5a4"),
    ("ğŸ˜ƒ", "1f603"), ("ğŸ’¯", "1f4af"), ("ğŸ™ˆ", "1f648"), ("ğŸ‘‡", "1f447"),
    ("ğŸ¶", "1f3b6"), ("ğŸ˜’", "1f612"), ("ğŸ¤­", "1f92d"), ("â£ï¸", "2763"),
    ("ğŸ˜œ", "1f61c"), ("ğŸ’‹", "1f48b"), ("ğŸ‘€", "1f440"), ("ğŸ˜ª", "1f62a"),
    ("ğŸ˜‘", "1f611"), ("ğŸ’¥", "1f4a5"), ("ğŸ™‹", "1f64b"), ("ğŸ˜", "1f61e"),
    ("ğŸ˜©", "1f629"), ("ğŸ˜¡", "1f621"), ("ğŸ¤ª", "1f92a"), ("ğŸ‘Š", "1f44a"),
    ("â˜€ï¸", "2600"), ("ğŸ˜¥", "1f625"), ("ğŸ¤¤", "1f924"), ("ğŸ‘‰", "1f449"),
    ("ğŸ’ƒ", "1f483"), ("ğŸ˜³", "1f633"), ("âœ‹", "270b"), ("ğŸ˜š", "1f61a"),
    ("ğŸ˜", "1f61d"), ("ğŸ˜´", "1f634"), ("ğŸŒŸ", "1f31f"), ("ğŸ˜¬", "1f62c"),
    ("ğŸ™ƒ", "1f643"), ("ğŸ€", "1f340"), ("ğŸŒ·", "1f337"), ("ğŸ˜»", "1f63b"),
    ("ğŸ˜“", "1f613"), ("â­", "2b50"), ("âœ…", "2705"), ("ğŸŒˆ", "1f308"),
    ("ğŸ˜ˆ", "1f608"), ("ğŸ¤˜", "1f918"), ("ğŸ’¦", "1f4a6"), ("âœ”ï¸", "2714"),
    
    # Gaming & Entertainment (100 emojis)
    ("ğŸ•¹ï¸", "1f579"), ("ğŸ®", "1f3ae"), ("ğŸ‘¾", "1f47e"), ("ğŸ¯", "1f3af"),
    ("ğŸ²", "1f3b2"), ("ğŸ†", "1f3c6"), ("âš”ï¸", "2694"), ("ğŸ›¡ï¸", "1f6e1"),
    ("ğŸ°", "1f3b0"), ("ğŸ…", "1f3c5"), ("ğŸ¥‡", "1f947"), ("ğŸ¥ˆ", "1f948"),
    ("ğŸ¥‰", "1f949"), ("ğŸª", "1f3aa"), ("ğŸ­", "1f3ad"), ("ğŸ¬", "1f3ac"),
    ("ğŸ¤", "1f3a4"), ("ğŸ§", "1f3a7"), ("ğŸ¼", "1f3bc"), ("ğŸ¹", "1f3b9"),
    ("ğŸ¥", "1f941"), ("ğŸ·", "1f3b7"), ("ğŸº", "1f3ba"), ("ğŸ¸", "1f3b8"),
    ("ğŸª•", "1fa95"), ("ğŸ»", "1f3bb"), ("ğŸ²", "1f3b2"), ("â™Ÿï¸", "265f"),
    ("ğŸ³", "1f3b3"), ("ğŸ£", "1f3a3"), ("ğŸ¿", "1f3bf"), ("ğŸ›·", "1f6f7"),
    ("ğŸ¥Œ", "1f94c"), ("ğŸ¯", "1f3af"), ("ğŸª€", "1fa80"), ("ğŸª", "1fa81"),
    ("ğŸ±", "1f3b1"), ("ğŸ”®", "1f52e"), ("ğŸª„", "1fa84"), ("ğŸ©", "1f3a9"),
    
    # Games we have + related
    ("ğŸ", "1f40d"), ("ğŸ§±", "1f9f1"), ("ğŸ“", "1f3d3"), ("ğŸ¸", "1f438"),
    ("ğŸ‘»", "1f47b"), ("ğŸ’", "1f352"), ("ğŸ", "1f34e"), ("ğŸŠ", "1f34a"),
    ("ğŸ‹", "1f34b"), ("ğŸŒ", "1f34c"), ("ğŸ‰", "1f349"), ("ğŸ‡", "1f347"),
    ("ğŸ“", "1f353"), ("ğŸ«", "1fad0"), ("ğŸˆ", "1f348"), ("ğŸ‘", "1f351"),
    ("ğŸ", "1f350"), ("ğŸ¥", "1f95d"), ("ğŸ…", "1f345"), ("ğŸ«’", "1fad2"),
    ("ğŸ¥¥", "1f965"), ("ğŸ¥‘", "1f951"), ("ğŸ†", "1f346"), ("ğŸ¥”", "1f954"),
    ("ğŸ¥•", "1f955"), ("ğŸŒ½", "1f33d"), ("ğŸŒ¶ï¸", "1f336"), ("ğŸ«‘", "1fad1"),
    ("ğŸ¥’", "1f952"), ("ğŸ¥¬", "1f96c"), ("ğŸ¥¦", "1f966"), ("ğŸ§„", "1f9c4"),
    
    # Animals & Nature (80 emojis)
    ("ğŸ¶", "1f436"), ("ğŸ±", "1f431"), ("ğŸ­", "1f42d"), ("ğŸ¹", "1f439"),
    ("ğŸ°", "1f430"), ("ğŸ¦Š", "1f98a"), ("ğŸ»", "1f43b"), ("ğŸ¼", "1f43c"),
    ("ğŸ¨", "1f428"), ("ğŸ¯", "1f42f"), ("ğŸ¦", "1f981"), ("ğŸ®", "1f42e"),
    ("ğŸ·", "1f437"), ("ğŸ½", "1f43d"), ("ğŸ¸", "1f438"), ("ğŸµ", "1f435"),
    ("ğŸ™ˆ", "1f648"), ("ğŸ™‰", "1f649"), ("ğŸ™Š", "1f64a"), ("ğŸ’", "1f412"),
    ("ğŸ”", "1f414"), ("ğŸ§", "1f427"), ("ğŸ¦", "1f426"), ("ğŸ¤", "1f424"),
    ("ğŸ£", "1f423"), ("ğŸ¥", "1f425"), ("ğŸ¦†", "1f986"), ("ğŸ¦…", "1f985"),
    ("ğŸ¦‰", "1f989"), ("ğŸ¦‡", "1f987"), ("ğŸº", "1f43a"), ("ğŸ—", "1f417"),
    ("ğŸ´", "1f434"), ("ğŸ¦„", "1f984"), ("ğŸ", "1f41d"), ("ğŸª±", "1fab1"),
    ("ğŸ›", "1f41b"), ("ğŸ¦‹", "1f98b"), ("ğŸŒ", "1f40c"), ("ğŸ", "1f41e"),
    ("ğŸœ", "1f41c"), ("ğŸª°", "1fab0"), ("ğŸª²", "1fab2"), ("ğŸª³", "1fab3"),
    ("ğŸ¦Ÿ", "1f99f"), ("ğŸ¦—", "1f997"), ("ğŸ•·ï¸", "1f577"), ("ğŸ•¸ï¸", "1f578"),
    ("ğŸ¦‚", "1f982"), ("ğŸ¢", "1f422"), ("ğŸ", "1f40d"), ("ğŸ¦", "1f98e"),
    ("ğŸ¦–", "1f996"), ("ğŸ¦•", "1f995"), ("ğŸ™", "1f419"), ("ğŸ¦‘", "1f991"),
    ("ğŸ¦", "1f990"), ("ğŸ¦", "1f99e"), ("ğŸ¦€", "1f980"), ("ğŸ¡", "1f421"),
    ("ğŸ ", "1f420"), ("ğŸŸ", "1f41f"), ("ğŸ¬", "1f42c"), ("ğŸ³", "1f433"),
    ("ğŸ‹", "1f40b"), ("ğŸ¦ˆ", "1f988"), ("ğŸŠ", "1f40a"), ("ğŸ…", "1f405"),
    ("ğŸ†", "1f406"), ("ğŸ¦“", "1f993"), ("ğŸ¦", "1f98d"), ("ğŸ¦§", "1f9a7"),
    ("ğŸ¦£", "1f9a3"), ("ğŸ˜", "1f418"), ("ğŸ¦›", "1f99b"), ("ğŸ¦", "1f98f"),
    ("ğŸª", "1f42a"), ("ğŸ«", "1f42b"), ("ğŸ¦’", "1f992"), ("ğŸ¦˜", "1f998"),
    
    # Weather & Nature (50 emojis)
    ("â˜€ï¸", "2600"), ("ğŸŒ¤ï¸", "1f324"), ("â›…", "26c5"), ("ğŸŒ¥ï¸", "1f325"),
    ("â˜ï¸", "2601"), ("ğŸŒ¦ï¸", "1f326"), ("ğŸŒ§ï¸", "1f327"), ("â›ˆï¸", "26c8"),
    ("ğŸŒ©ï¸", "1f329"), ("ğŸŒ¨ï¸", "1f328"), ("â„ï¸", "2744"), ("â˜ƒï¸", "2603"),
    ("â›„", "26c4"), ("ğŸŒ¬ï¸", "1f32c"), ("ğŸ’¨", "1f4a8"), ("ğŸ’§", "1f4a7"),
    ("ğŸ’¦", "1f4a6"), ("â˜”", "2614"), ("â˜‚ï¸", "2602"), ("ğŸŒŠ", "1f30a"),
    ("ğŸŒ«ï¸", "1f32b"), ("ğŸŒªï¸", "1f32a"), ("ğŸŒˆ", "1f308"), ("ğŸŒ…", "1f305"),
    ("ğŸŒ„", "1f304"), ("ğŸŒ ", "1f320"), ("ğŸŒŒ", "1f30c"), ("â›…", "26c5"),
    ("ğŸŒ¡ï¸", "1f321"), ("ğŸ”¥", "1f525"), ("ğŸ’¥", "1f4a5"), ("âœ¨", "2728"),
    ("â­", "2b50"), ("ğŸŒŸ", "1f31f"), ("ğŸ’«", "1f4ab"), ("âš¡", "26a1"),
    ("â˜„ï¸", "2604"), ("ğŸ’¥", "1f4a5"), ("ğŸ”¥", "1f525"), ("ğŸŒªï¸", "1f32a"),
    ("ğŸŒˆ", "1f308"), ("â˜€ï¸", "2600"), ("ğŸŒ™", "1f319"), ("ğŸŒš", "1f31a"),
    ("ğŸŒ", "1f31d"), ("ğŸŒ›", "1f31b"), ("ğŸŒœ", "1f31c"), ("ğŸŒ", "1f31e"),
    ("â­", "2b50"), ("ğŸŒŸ", "1f31f"),
    
    # Time & Clocks (30 emojis)
    ("â°", "23f0"), ("â²ï¸", "23f2"), ("â±ï¸", "23f1"), ("âŒš", "231a"),
    ("âŒ›", "231b"), ("â³", "23f3"), ("ğŸ“…", "1f4c5"), ("ğŸ“†", "1f4c6"),
    ("ğŸ•", "1f550"), ("ğŸ•‘", "1f551"), ("ğŸ•’", "1f552"), ("ğŸ•“", "1f553"),
    ("ğŸ•”", "1f554"), ("ğŸ••", "1f555"), ("ğŸ•–", "1f556"), ("ğŸ•—", "1f557"),
    ("ğŸ•˜", "1f558"), ("ğŸ•™", "1f559"), ("ğŸ•š", "1f55a"), ("ğŸ•›", "1f55b"),
    ("ğŸ•œ", "1f55c"), ("ğŸ•", "1f55d"), ("ğŸ•", "1f55e"), ("ğŸ•Ÿ", "1f55f"),
    ("ğŸ• ", "1f560"), ("ğŸ•¡", "1f561"), ("ğŸ•¢", "1f562"), ("ğŸ•£", "1f563"),
    ("ğŸ•¤", "1f564"), ("ğŸ•¥", "1f565"),
    
    # UI Elements & Symbols (120 emojis)
    ("â–¶ï¸", "25b6"), ("â¸ï¸", "23f8"), ("â¹ï¸", "23f9"), ("âºï¸", "23fa"),
    ("â­ï¸", "23ed"), ("â®ï¸", "23ee"), ("â©", "23e9"), ("âª", "23ea"),
    ("â«", "23eb"), ("â¬", "23ec"), ("ğŸ”€", "1f500"), ("ğŸ”", "1f501"),
    ("ğŸ”‚", "1f502"), ("ğŸ”„", "1f504"), ("ğŸ”ƒ", "1f503"), ("â¡ï¸", "27a1"),
    ("â¬…ï¸", "2b05"), ("â¬†ï¸", "2b06"), ("â¬‡ï¸", "2b07"), ("â†—ï¸", "2197"),
    ("â†˜ï¸", "2198"), ("â†™ï¸", "2199"), ("â†–ï¸", "2196"), ("â†•ï¸", "2195"),
    ("â†”ï¸", "2194"), ("â†©ï¸", "21a9"), ("â†ªï¸", "21aa"), ("â¤´ï¸", "2934"),
    ("â¤µï¸", "2935"), ("ğŸ”¼", "1f53c"), ("ğŸ”½", "1f53d"), ("â—€ï¸", "25c0"),
    ("ğŸ”º", "1f53a"), ("ğŸ”»", "1f53b"), ("ğŸ”¶", "1f536"), ("ğŸ”·", "1f537"),
    ("ğŸ”¸", "1f538"), ("ğŸ”¹", "1f539"), ("ğŸ”˜", "1f518"), ("âšª", "26aa"),
    ("âš«", "26ab"), ("ğŸŸ¤", "1f7e4"), ("ğŸ”´", "1f534"), ("ğŸŸ ", "1f7e0"),
    ("ğŸŸ¡", "1f7e1"), ("ğŸŸ¢", "1f7e2"), ("ğŸ”µ", "1f535"), ("ğŸŸ£", "1f7e3"),
    ("ğŸŸ¥", "1f7e5"), ("ğŸŸ§", "1f7e7"), ("ğŸŸ¨", "1f7e8"), ("ğŸŸ©", "1f7e9"),
    ("ğŸŸ¦", "1f7e6"), ("ğŸŸª", "1f7ea"), ("â¬›", "2b1b"), ("â¬œ", "2b1c"),
    ("ğŸŸ«", "1f7eb"), ("âœ…", "2705"), ("â˜‘ï¸", "2611"), ("âœ”ï¸", "2714"),
    ("âŒ", "274c"), ("â", "274e"), ("â•", "2795"), ("â–", "2796"),
    ("â—", "2797"), ("âœ–ï¸", "2716"), ("ğŸ’¯", "1f4af"), ("ğŸ’¢", "1f4a2"),
    ("ğŸ’¬", "1f4ac"), ("ğŸ’­", "1f4ad"), ("ğŸ—¨ï¸", "1f5e8"), ("ğŸ—¯ï¸", "1f5ef"),
    ("ğŸ’¤", "1f4a4"), ("ğŸ’®", "1f4ae"), ("â™ ï¸", "2660"), ("â™¥ï¸", "2665"),
    ("â™¦ï¸", "2666"), ("â™£ï¸", "2663"), ("ğŸƒ", "1f0cf"), ("ğŸ€„", "1f004"),
    ("ğŸ´", "1f3b4"), ("â„¹ï¸", "2139"), ("â“", "2753"), ("â”", "2754"),
    ("â•", "2755"), ("â—", "2757"), ("â‰ï¸", "2049"), ("â€¼ï¸", "203c"),
    ("âš ï¸", "26a0"), ("ğŸš¸", "1f6b8"), ("ğŸ”±", "1f531"), ("âšœï¸", "269c"),
    ("ã€½ï¸", "303d"), ("âš•ï¸", "2695"), ("â™»ï¸", "267b"), ("âš›ï¸", "269b"),
    ("ğŸ•‰ï¸", "1f549"), ("âœ¡ï¸", "2721"), ("â˜¸ï¸", "2638"), ("â˜¯ï¸", "262f"),
    ("âœï¸", "271d"), ("â˜¦ï¸", "2626"), ("â˜ªï¸", "262a"), ("â˜®ï¸", "262e"),
    ("ğŸ•", "1f54e"), ("ğŸ”¯", "1f52f"), ("â™ˆ", "2648"), ("â™‰", "2649"),
    
    # Numbers & Letters (40 emojis)
    ("0ï¸âƒ£", "0030-20e3"), ("1ï¸âƒ£", "0031-20e3"), ("2ï¸âƒ£", "0032-20e3"),
    ("3ï¸âƒ£", "0033-20e3"), ("4ï¸âƒ£", "0034-20e3"), ("5ï¸âƒ£", "0035-20e3"),
    ("6ï¸âƒ£", "0036-20e3"), ("7ï¸âƒ£", "0037-20e3"), ("8ï¸âƒ£", "0038-20e3"),
    ("9ï¸âƒ£", "0039-20e3"), ("ğŸ”Ÿ", "1f51f"), ("#ï¸âƒ£", "0023-20e3"),
    ("*ï¸âƒ£", "002a-20e3"), ("ğŸ…°ï¸", "1f170"), ("ğŸ…±ï¸", "1f171"), ("ğŸ†", "1f18e"),
    ("ğŸ…¾ï¸", "1f17e"), ("ğŸ†‘", "1f191"), ("ğŸ†’", "1f192"), ("ğŸ†“", "1f193"),
    ("ğŸ†”", "1f194"), ("ğŸ†•", "1f195"), ("ğŸ†–", "1f196"), ("ğŸ†—", "1f197"),
    ("ğŸ†˜", "1f198"), ("ğŸ†™", "1f199"), ("ğŸ†š", "1f19a"), ("ğŸˆ", "1f201"),
    ("ğŸˆ‚ï¸", "1f202"), ("ğŸˆ·ï¸", "1f237"), ("ğŸˆ¶", "1f236"), ("ğŸˆ¯", "1f22f"),
    ("ğŸ‰", "1f250"), ("ğŸˆ¹", "1f239"), ("ğŸˆš", "1f21a"), ("ğŸˆ²", "1f232"),
    ("ğŸ‰‘", "1f251"), ("ğŸˆ¸", "1f238"), ("ğŸˆ´", "1f234"), ("ğŸˆ³", "1f233"),
    
    # Tech & Objects (100 emojis)
    ("ğŸ“±", "1f4f1"), ("ğŸ’»", "1f4bb"), ("âŒ¨ï¸", "2328"), ("ğŸ–¥ï¸", "1f5a5"),
    ("ğŸ–¨ï¸", "1f5a8"), ("ğŸ–±ï¸", "1f5b1"), ("ğŸ–²ï¸", "1f5b2"), ("ğŸ•¹ï¸", "1f579"),
    ("ğŸ—œï¸", "1f5dc"), ("ğŸ’¾", "1f4be"), ("ğŸ’¿", "1f4bf"), ("ğŸ“€", "1f4c0"),
    ("ğŸ“¼", "1f4fc"), ("ğŸ“·", "1f4f7"), ("ğŸ“¸", "1f4f8"), ("ğŸ“¹", "1f4f9"),
    ("ğŸ¥", "1f3a5"), ("ğŸ“½ï¸", "1f4fd"), ("ğŸï¸", "1f39e"), ("ğŸ“", "1f4de"),
    ("â˜ï¸", "260e"), ("ğŸ“Ÿ", "1f4df"), ("ğŸ“ ", "1f4e0"), ("ğŸ“º", "1f4fa"),
    ("ğŸ“»", "1f4fb"), ("ğŸ™ï¸", "1f399"), ("ğŸšï¸", "1f39a"), ("ğŸ›ï¸", "1f39b"),
    ("ğŸ§­", "1f9ed"), ("â±ï¸", "23f1"), ("â²ï¸", "23f2"), ("â°", "23f0"),
    ("ğŸ•°ï¸", "1f570"), ("âŒ›", "231b"), ("â³", "23f3"), ("ğŸ“¡", "1f4e1"),
    ("ğŸ”‹", "1f50b"), ("ğŸ”Œ", "1f50c"), ("ğŸ’¡", "1f4a1"), ("ğŸ”¦", "1f526"),
    ("ğŸ•¯ï¸", "1f56f"), ("ğŸª”", "1fa94"), ("ğŸ§¯", "1f9ef"), ("ğŸ›¢ï¸", "1f6e2"),
    ("ğŸ’¸", "1f4b8"), ("ğŸ’µ", "1f4b5"), ("ğŸ’´", "1f4b4"), ("ğŸ’¶", "1f4b6"),
    ("ğŸ’·", "1f4b7"), ("ğŸª™", "1fa99"), ("ğŸ’°", "1f4b0"), ("ğŸ’³", "1f4b3"),
    ("ğŸ§¾", "1f9fe"), ("ğŸ“Š", "1f4ca"), ("ğŸ“ˆ", "1f4c8"), ("ğŸ“‰", "1f4c9"),
    ("ğŸ“Œ", "1f4cc"), ("ğŸ“", "1f4cd"), ("ğŸ“", "1f4ce"), ("ğŸ–‡ï¸", "1f587"),
    ("ğŸ“", "1f4cf"), ("ğŸ“", "1f4d0"), ("âœ‚ï¸", "2702"), ("ğŸ—‚ï¸", "1f5c2"),
    ("ğŸ—ƒï¸", "1f5c3"), ("ğŸ—„ï¸", "1f5c4"), ("ğŸ—‘ï¸", "1f5d1"), ("ğŸ”’", "1f512"),
    ("ğŸ”“", "1f513"), ("ğŸ”", "1f50f"), ("ğŸ”", "1f510"), ("ğŸ”‘", "1f511"),
    ("ğŸ—ï¸", "1f5dd"), ("ğŸ”¨", "1f528"), ("ğŸª“", "1fa93"), ("â›ï¸", "26cf"),
    ("âš’ï¸", "2692"), ("ğŸ› ï¸", "1f6e0"), ("ğŸ—¡ï¸", "1f5e1"), ("âš”ï¸", "2694"),
    ("ğŸ”«", "1f52b"), ("ğŸªƒ", "1fa83"), ("ğŸ¹", "1f3f9"), ("ğŸ›¡ï¸", "1f6e1"),
    ("ğŸªš", "1fa9a"), ("ğŸ”§", "1f527"), ("ğŸª›", "1fa9b"), ("ğŸ”©", "1f529"),
    ("âš™ï¸", "2699"), ("ğŸ—œï¸", "1f5dc"), ("âš–ï¸", "2696"), ("ğŸ¦¯", "1f9af"),
    ("ğŸ”—", "1f517"), ("â›“ï¸", "26d3"), ("ğŸª", "1fa9d"), ("ğŸ§°", "1f9f0"),
    
    # Food & Drink (50 emojis)
    ("ğŸ•", "1f355"), ("ğŸ”", "1f354"), ("ğŸŸ", "1f35f"), ("ğŸŒ­", "1f32d"),
    ("ğŸ¿", "1f37f"), ("ğŸ§ˆ", "1f9c8"), ("ğŸ§‚", "1f9c2"), ("ğŸ¥“", "1f953"),
    ("ğŸ¥š", "1f95a"), ("ğŸ³", "1f373"), ("ğŸ§‡", "1f9c7"), ("ğŸ¥", "1f95e"),
    ("ğŸ§ˆ", "1f9c8"), ("ğŸ", "1f35e"), ("ğŸ¥", "1f950"), ("ğŸ¥–", "1f956"),
    ("ğŸ«“", "1fad3"), ("ğŸ¥¨", "1f968"), ("ğŸ¥¯", "1f96f"), ("ğŸ¥", "1f95e"),
    ("ğŸ§‡", "1f9c7"), ("ğŸ§€", "1f9c0"), ("ğŸ–", "1f356"), ("ğŸ—", "1f357"),
    ("ğŸ¥©", "1f969"), ("ğŸ¥“", "1f953"), ("ğŸ”", "1f354"), ("ğŸŸ", "1f35f"),
    ("ğŸ•", "1f355"), ("ğŸŒ­", "1f32d"), ("ğŸ¥ª", "1f96a"), ("ğŸŒ®", "1f32e"),
    ("ğŸŒ¯", "1f32f"), ("ğŸ«”", "1fad4"), ("ğŸ¥™", "1f959"), ("ğŸ§†", "1f9c6"),
    ("ğŸ", "1f35d"), ("ğŸœ", "1f35c"), ("ğŸ²", "1f372"), ("ğŸ›", "1f35b"),
    ("ğŸ£", "1f363"), ("ğŸ±", "1f371"), ("ğŸ¥Ÿ", "1f95f"), ("ğŸ¦ª", "1f9aa"),
    ("ğŸ¤", "1f364"), ("ğŸ™", "1f359"), ("ğŸš", "1f35a"), ("ğŸ˜", "1f358"),
    ("ğŸ¥", "1f365"), ("ğŸ¥ ", "1f960"),
    
    # Misc Popular (remaining to reach 800)
    ("ğŸ ", "1f3e0"), ("ğŸ¡", "1f3e1"), ("ğŸ¢", "1f3e2"), ("ğŸ£", "1f3e3"),
    ("ğŸ¤", "1f3e4"), ("ğŸ¥", "1f3e5"), ("ğŸ¦", "1f3e6"), ("ğŸ¨", "1f3e8"),
    ("ğŸ©", "1f3e9"), ("ğŸª", "1f3ea"), ("ğŸ«", "1f3eb"), ("ğŸ¬", "1f3ec"),
    ("ğŸ­", "1f3ed"), ("ğŸ¯", "1f3ef"), ("ğŸ°", "1f3f0"), ("ğŸ’’", "1f492"),
    ("ğŸ—¼", "1f5fc"), ("ğŸ—½", "1f5fd"), ("â›ª", "26ea"), ("ğŸ•Œ", "1f54c"),
    ("ğŸ›•", "1f6d5"), ("ğŸ•", "1f54d"), ("â›©ï¸", "26e9"), ("ğŸ•‹", "1f54b"),
]


def download_emoji_png(codepoint, size=32, max_retries=3):
    """Download emoji PNG from Noto Emoji repository."""
    url = f"https://raw.githubusercontent.com/googlefonts/noto-emoji/main/png/{size}/emoji_u{codepoint}.png"
    
    for attempt in range(max_retries):
        try:
            with urllib.request.urlopen(url, timeout=10) as response:
                img_data = response.read()
                return Image.open(io.BytesIO(img_data))
        except Exception as e:
            if attempt == max_retries - 1:
                print(f"    âŒ Failed after {max_retries} attempts: {e}")
                return None
            time.sleep(0.5)  # Brief pause before retry
    return None


def generate_spritesheet(emoji_list, output_prefix='matrixos/emoji_spritesheet', size=32, columns=40):
    """Generate emoji sprite sheet and metadata.
    
    Args:
        emoji_list: List of (emoji, codepoint) tuples
        output_prefix: Output file path prefix
        size: Emoji size (32)
        columns: Number of columns in sprite sheet
    """
    rows = (len(emoji_list) + columns - 1) // columns  # Ceiling division
    
    print("="*70)
    print(f"Generating Emoji Sprite Sheet")
    print("="*70)
    print(f"Total emojis: {len(emoji_list)}")
    print(f"Grid: {columns} columns Ã— {rows} rows")
    print(f"Size: {columns * size} Ã— {rows * size} pixels")
    print(f"Output: {output_prefix}.png")
    print("="*70)
    
    # Create sprite sheet image
    sheet_width = columns * size
    sheet_height = rows * size
    sprite_sheet = Image.new('RGBA', (sheet_width, sheet_height), (0, 0, 0, 0))
    
    # Metadata
    metadata = {
        "version": "1.0",
        "emoji_size": size,
        "columns": columns,
        "rows": rows,
        "total_emojis": len(emoji_list),
        "emojis": {}
    }
    
    success_count = 0
    fail_count = 0
    
    for idx, (emoji, codepoint) in enumerate(emoji_list):
        row = idx // columns
        col = idx % columns
        
        if idx % 50 == 0:
            print(f"\nProgress: {idx}/{len(emoji_list)} ({100*idx//len(emoji_list)}%)")
        
        # Download emoji
        img = download_emoji_png(codepoint, size)
        
        if img:
            # Paste into sprite sheet
            x = col * size
            y = row * size
            sprite_sheet.paste(img, (x, y))
            
            # Add to metadata
            metadata["emojis"][emoji] = {
                "codepoint": codepoint,
                "row": row,
                "col": col,
                "x": x,
                "y": y
            }
            
            success_count += 1
            print(f"  âœ… {emoji} ({codepoint})", end='')
        else:
            fail_count += 1
            print(f"  âŒ {emoji} ({codepoint})", end='')
    
    # Save sprite sheet
    sprite_sheet.save(f"{output_prefix}.png", "PNG", optimize=True)
    sheet_size = os.path.getsize(f"{output_prefix}.png")
    
    # Save metadata
    with open(f"{output_prefix}.json", 'w') as f:
        json.dump(metadata, f, indent=2, ensure_ascii=False)
    
    metadata_size = os.path.getsize(f"{output_prefix}.json")
    
    print("\n" + "="*70)
    print(f"âœ… Successfully added: {success_count} emojis")
    print(f"âŒ Failed: {fail_count} emojis")
    print(f"ğŸ“Š Sprite sheet: {sheet_size / 1024:.1f} KB")
    print(f"ğŸ“Š Metadata: {metadata_size / 1024:.1f} KB")
    print(f"ğŸ“Š Total: {(sheet_size + metadata_size) / 1024:.1f} KB")
    print("="*70)
    
    return success_count, fail_count


if __name__ == '__main__':
    try:
        from PIL import Image
    except ImportError:
        print("Error: Pillow (PIL) required!")
        print("Install with: sudo apt-get install python3-pil")
        exit(1)
    
    # Ensure output directory exists
    os.makedirs('matrixos', exist_ok=True)
    
    # Generate the sprite sheet
    success, fail = generate_spritesheet(EMOJI_LIST)
    
    if success > 0:
        print(f"\nâœ¨ Sprite sheet generated successfully!")
        print(f"   Add matrixos/emoji_spritesheet.png to your repo")
        print(f"   Single file, {success} emojis ready to use offline! ğŸ‰")
    else:
        print(f"\nâŒ Failed to generate sprite sheet")
        exit(1)
